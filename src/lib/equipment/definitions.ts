import type { Enchantment, EquipmentDefinition, LootTable } from './types';

// ===== Enchantment Definitions =====

export const ENCHANTMENTS: Record<string, Enchantment> = {
    auto_react: {
        type: 'auto_react',
        name: 'Auto React',
        nameJa: 'è‡ªå‹•åå¿œ',
        description: '10% chance to auto-trigger a random reaction on line clear',
        descriptionJa: 'ãƒ©ã‚¤ãƒ³æ¶ˆå»æ™‚10%ã®ç¢ºç‡ã§ãƒ©ãƒ³ãƒ€ãƒ ãªåå¿œã‚’è‡ªå‹•ç™ºå‹•',
        color: '#FF6B6B',
    },
    orb_magnet: {
        type: 'orb_magnet',
        name: 'Orb Magnet',
        nameJa: 'ã‚ªãƒ¼ãƒ–ç£çŸ³',
        description: 'Orbs are collected 50% faster',
        descriptionJa: 'ã‚ªãƒ¼ãƒ–ã®å›åé€Ÿåº¦ãŒ50%ä¸Šæ˜‡',
        color: '#4FC3F7',
    },
    lucky_crit: {
        type: 'lucky_crit',
        name: 'Lucky Crit',
        nameJa: 'å¹¸é‹ã®ä¸€æ’ƒ',
        description: '5% chance for 3x score on perfect beat',
        descriptionJa: 'ãƒ‘ãƒ¼ãƒ•ã‚§ã‚¯ãƒˆãƒ“ãƒ¼ãƒˆæ™‚5%ã®ç¢ºç‡ã§ã‚¹ã‚³ã‚¢3å€',
        color: '#FFD700',
    },
    terrain_shatter: {
        type: 'terrain_shatter',
        name: 'Terrain Shatter',
        nameJa: 'åœ°å½¢ç²‰ç •',
        description: 'Line clears destroy +2 extra terrain blocks',
        descriptionJa: 'ãƒ©ã‚¤ãƒ³æ¶ˆå»æ™‚ã«è¿½åŠ ã§åœ°å½¢ãƒ–ãƒ­ãƒƒã‚¯2å€‹ç ´å£Š',
        color: '#8D6E63',
    },
    combo_shield: {
        type: 'combo_shield',
        name: 'Combo Shield',
        nameJa: 'ã‚³ãƒ³ãƒœã‚·ãƒ¼ãƒ«ãƒ‰',
        description: 'First combo break per stage is ignored',
        descriptionJa: 'ã‚¹ãƒ†ãƒ¼ã‚¸ã”ã¨ã«æœ€åˆã®ã‚³ãƒ³ãƒœé€”åˆ‡ã‚Œã‚’ç„¡åŠ¹åŒ–',
        color: '#42A5F5',
    },
    element_surge: {
        type: 'element_surge',
        name: 'Element Surge',
        nameJa: 'ã‚¨ãƒ¬ãƒ¡ãƒ³ãƒˆã‚µãƒ¼ã‚¸',
        description: 'Reactions generate 1 extra orb of each consumed element',
        descriptionJa: 'åå¿œç™ºå‹•æ™‚ã€æ¶ˆè²»ã—ãŸå„å±æ€§ã®ã‚ªãƒ¼ãƒ–ã‚’1å€‹è¿½åŠ ç”Ÿæˆ',
        color: '#AB47BC',
    },
    material_convert: {
        type: 'material_convert',
        name: 'Material Convert',
        nameJa: 'ç´ æå¤‰æ›',
        description: '20% chance to upgrade material rarity on drop',
        descriptionJa: 'ç´ æãƒ‰ãƒ­ãƒƒãƒ—æ™‚20%ã®ç¢ºç‡ã§ãƒ¬ã‚¢ãƒªãƒ†ã‚£ãŒä¸Šæ˜‡',
        color: '#66BB6A',
    },
    beat_echo: {
        type: 'beat_echo',
        name: 'Beat Echo',
        nameJa: 'ãƒ“ãƒ¼ãƒˆã‚¨ã‚³ãƒ¼',
        description: 'PERFECT judgments count as 2 beats for gauge charging',
        descriptionJa: 'PERFECTåˆ¤å®šãŒã‚²ãƒ¼ã‚¸ãƒãƒ£ãƒ¼ã‚¸ç”¨ã«2ãƒ“ãƒ¼ãƒˆåˆ†ã¨ã—ã¦ã‚«ã‚¦ãƒ³ãƒˆ',
        color: '#EF5350',
    },
};

/** All enchantments as a flat array */
export const ALL_ENCHANTMENTS: Enchantment[] = Object.values(ENCHANTMENTS);

/** All enchantment types for weighted random selection */
export const ALL_ENCHANTMENT_TYPES = ALL_ENCHANTMENTS.map(e => e.type);

// ===== Equipment Definitions =====

const EQUIPMENT: EquipmentDefinition[] = [
    // â”€â”€ Weapons (offense) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    {
        id: 'wooden_baton',
        name: 'Wooden Baton',
        nameJa: 'æœ¨ã®ãƒãƒˆãƒ³',
        slot: 'weapon',
        rarity: 'common',
        icon: 'ğŸªµ',
        color: '#8B6914',
        glowColor: '#A0822B',
        description: 'A simple baton carved from driftwood. Keeps the rhythm going.',
        descriptionJa: 'æµæœ¨ã‚’å‰Šã£ã¦ä½œã£ãŸç´ æœ´ãªãƒãƒˆãƒ³ã€‚ãƒªã‚ºãƒ ã‚’åˆ»ã¿ç¶šã‘ã‚‹ã€‚',
        baseStats: [{ stat: 'scorePercent', value: 5 }],
        enchantmentSlots: 0,
    },
    {
        id: 'crystal_wand',
        name: 'Crystal Wand',
        nameJa: 'ã‚¯ãƒªã‚¹ã‚¿ãƒ«ãƒ¯ãƒ³ãƒ‰',
        slot: 'weapon',
        rarity: 'uncommon',
        icon: 'ğŸ”®',
        color: '#4FC3F7',
        glowColor: '#81D4FA',
        description: 'A wand tipped with a resonating crystal that amplifies rhythmic energy.',
        descriptionJa: 'å…±é³´ã™ã‚‹æ°´æ™¶ãŒå…ˆç«¯ã«ä»˜ã„ãŸæ–ã€‚ãƒªã‚ºãƒ ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’å¢—å¹…ã™ã‚‹ã€‚',
        baseStats: [
            { stat: 'scorePercent', value: 10 },
            { stat: 'elementalAffinity', value: 5, element: 'water' },
        ],
        enchantmentSlots: 0,
    },
    {
        id: 'flame_striker',
        name: 'Flame Striker',
        nameJa: 'ãƒ•ãƒ¬ã‚¤ãƒ ã‚¹ãƒˆãƒ©ã‚¤ã‚«ãƒ¼',
        slot: 'weapon',
        rarity: 'rare',
        icon: 'ğŸ”¥',
        color: '#FF4444',
        glowColor: '#FF8866',
        description: 'A blazing conductor\'s baton wreathed in eternal fire.',
        descriptionJa: 'æ°¸é ã®ç‚ã«åŒ…ã¾ã‚ŒãŸæŒ‡æ®æ£’ã€‚',
        baseStats: [
            { stat: 'scorePercent', value: 15 },
            { stat: 'elementalAffinity', value: 10, element: 'fire' },
        ],
        enchantmentSlots: 0,
    },
    {
        id: 'thunder_gavel',
        name: 'Thunder Gavel',
        nameJa: 'ã‚µãƒ³ãƒ€ãƒ¼ã‚¬ãƒ™ãƒ«',
        slot: 'weapon',
        rarity: 'epic',
        icon: 'âš¡',
        color: '#FFDD44',
        glowColor: '#FFEE88',
        description: 'A gavel forged from thunderstone. Each strike resonates with the storm.',
        descriptionJa: 'é›·çŸ³ã§é›é€ ã•ã‚ŒãŸæ§Œã€‚ä¸€æ’ƒã”ã¨ã«åµãŒå…±é³´ã™ã‚‹ã€‚',
        baseStats: [
            { stat: 'scorePercent', value: 25 },
            { stat: 'elementalAffinity', value: 15, element: 'lightning' },
        ],
        enchantmentSlots: 1,
    },
    {
        id: 'star_conductor_baton',
        name: 'Star Conductor\'s Baton',
        nameJa: 'æ˜Ÿã®æŒ‡æ®æ£’',
        slot: 'weapon',
        rarity: 'legendary',
        icon: 'âœ¨',
        color: '#FFFFFF',
        glowColor: '#F0F0FF',
        description: 'The baton of the celestial orchestra. Commands all elements in harmony.',
        descriptionJa: 'å¤©çƒã®ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ©ã®æŒ‡æ®æ£’ã€‚å…¨å±æ€§ã‚’èª¿å’Œã®ã†ã¡ã«çµ±ã¹ã‚‹ã€‚',
        baseStats: [
            { stat: 'scorePercent', value: 40 },
            { stat: 'elementalAffinity', value: 20, element: 'fire' },
            { stat: 'elementalAffinity', value: 20, element: 'water' },
            { stat: 'elementalAffinity', value: 20, element: 'ice' },
            { stat: 'elementalAffinity', value: 20, element: 'lightning' },
            { stat: 'elementalAffinity', value: 20, element: 'nature' },
            { stat: 'elementalAffinity', value: 20, element: 'dark' },
        ],
        enchantmentSlots: 2,
    },
    {
        id: 'dark_requiem',
        name: 'Dark Requiem',
        nameJa: 'ãƒ€ãƒ¼ã‚¯ãƒ¬ã‚¯ã‚¤ã‚¨ãƒ ',
        slot: 'weapon',
        rarity: 'rare',
        icon: 'ğŸŒ‘',
        color: '#9944CC',
        glowColor: '#BB66EE',
        description: 'A shadowy baton that draws power from the void between beats.',
        descriptionJa: 'ãƒ“ãƒ¼ãƒˆã®é–“ã®è™šç„¡ã‹ã‚‰åŠ›ã‚’å¼•ãå‡ºã™å½±ã®ãƒãƒˆãƒ³ã€‚',
        baseStats: [
            { stat: 'scorePercent', value: 12 },
            { stat: 'elementalAffinity', value: 15, element: 'dark' },
            { stat: 'reactionPower', value: 8 },
        ],
        enchantmentSlots: 0,
    },

    // â”€â”€ Armor (defense) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    {
        id: 'cloth_robe',
        name: 'Cloth Robe',
        nameJa: 'å¸ƒã®ãƒ­ãƒ¼ãƒ–',
        slot: 'armor',
        rarity: 'common',
        icon: 'ğŸ‘˜',
        color: '#8B8B8B',
        glowColor: '#A0A0A0',
        description: 'A simple cloth robe. Offers minimal protection but keeps you moving.',
        descriptionJa: 'ã‚·ãƒ³ãƒ—ãƒ«ãªå¸ƒã®ãƒ­ãƒ¼ãƒ–ã€‚æœ€ä½é™ã®å®ˆã‚Šã ãŒå‹•ãã‚„ã™ã„ã€‚',
        baseStats: [{ stat: 'comboDuration', value: 50 }],
        enchantmentSlots: 0,
    },
    {
        id: 'iron_vest',
        name: 'Iron Vest',
        nameJa: 'ã‚¢ã‚¤ã‚¢ãƒ³ãƒ™ã‚¹ãƒˆ',
        slot: 'armor',
        rarity: 'uncommon',
        icon: 'ğŸ¦º',
        color: '#B87333',
        glowColor: '#D4956B',
        description: 'A sturdy vest reinforced with iron plates. Slows gravity slightly.',
        descriptionJa: 'é‰„æ¿ã§è£œå¼·ã•ã‚ŒãŸé ‘ä¸ˆãªãƒ™ã‚¹ãƒˆã€‚é‡åŠ›ãŒã‚ãšã‹ã«è»½æ¸›ã•ã‚Œã‚‹ã€‚',
        baseStats: [
            { stat: 'comboDuration', value: 100 },
            { stat: 'gravityReduce', value: 3 },
        ],
        enchantmentSlots: 0,
    },
    {
        id: 'crystal_mail',
        name: 'Crystal Mail',
        nameJa: 'ã‚¯ãƒªã‚¹ã‚¿ãƒ«ãƒ¡ã‚¤ãƒ«',
        slot: 'armor',
        rarity: 'rare',
        icon: 'ğŸ’',
        color: '#4FC3F7',
        glowColor: '#81D4FA',
        description: 'Armor woven from crystallized rhythm. Resonates with every beat.',
        descriptionJa: 'çµæ™¶åŒ–ã—ãŸãƒªã‚ºãƒ ã§ç·¨ã¾ã‚ŒãŸé§ã€‚ãƒ“ãƒ¼ãƒˆã”ã¨ã«å…±é³´ã™ã‚‹ã€‚',
        baseStats: [
            { stat: 'comboDuration', value: 150 },
            { stat: 'gravityReduce', value: 5 },
        ],
        enchantmentSlots: 0,
    },
    {
        id: 'obsidian_plate',
        name: 'Obsidian Plate',
        nameJa: 'ã‚ªãƒ–ã‚·ãƒ‡ã‚£ã‚¢ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ',
        slot: 'armor',
        rarity: 'epic',
        icon: 'ğŸª¨',
        color: '#9C27B0',
        glowColor: '#CE93D8',
        description: 'Plate armor of volcanic obsidian. Dark energy cushions every impact.',
        descriptionJa: 'ç«å±±ã®é»’æ›œçŸ³ã§ä½œã‚‰ã‚ŒãŸãƒ—ãƒ¬ãƒ¼ãƒˆã‚¢ãƒ¼ãƒãƒ¼ã€‚æš—é»’ã‚¨ãƒãƒ«ã‚®ãƒ¼ãŒè¡æ’ƒã‚’å¸åã€‚',
        baseStats: [
            { stat: 'comboDuration', value: 200 },
            { stat: 'gravityReduce', value: 8 },
        ],
        enchantmentSlots: 1,
    },
    {
        id: 'star_aegis',
        name: 'Star Aegis',
        nameJa: 'æ˜Ÿç›¾ã®é§',
        slot: 'armor',
        rarity: 'legendary',
        icon: 'ğŸŒŸ',
        color: '#FFFFFF',
        glowColor: '#F0F0FF',
        description: 'Celestial armor forged from starlight. Gravity itself bends around the wearer.',
        descriptionJa: 'æ˜Ÿå…‰ã‹ã‚‰é›é€ ã•ã‚ŒãŸå¤©çƒã®é§ã€‚é‡åŠ›ã™ã‚‰è£…ç€è€…ã®å‘¨ã‚Šã§æ­ªã‚€ã€‚',
        baseStats: [
            { stat: 'comboDuration', value: 300 },
            { stat: 'gravityReduce', value: 15 },
        ],
        enchantmentSlots: 2,
    },
    {
        id: 'nature_weave',
        name: 'Nature Weave',
        nameJa: 'ãƒã‚¤ãƒãƒ£ãƒ¼ã‚¦ã‚£ãƒ¼ãƒ–',
        slot: 'armor',
        rarity: 'rare',
        icon: 'ğŸŒ¿',
        color: '#44CC44',
        glowColor: '#66EE66',
        description: 'Living vines form a protective shell that regenerates with nature\'s pulse.',
        descriptionJa: 'ç”ŸããŸè”“ãŒè‡ªç„¶ã®è„ˆå‹•ã¨å…±ã«å†ç”Ÿã™ã‚‹é˜²è­·æ®»ã‚’å½¢æˆã™ã‚‹ã€‚',
        baseStats: [
            { stat: 'comboDuration', value: 120 },
            { stat: 'gravityReduce', value: 4 },
            { stat: 'elementalAffinity', value: 10, element: 'nature' },
        ],
        enchantmentSlots: 0,
    },

    // â”€â”€ Accessories (utility) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    {
        id: 'wooden_ring',
        name: 'Wooden Ring',
        nameJa: 'æœ¨ã®ãƒªãƒ³ã‚°',
        slot: 'accessory',
        rarity: 'common',
        icon: 'ğŸ’',
        color: '#8B6914',
        glowColor: '#A0822B',
        description: 'A simple wooden ring. Slightly widens the beat timing window.',
        descriptionJa: 'ã‚·ãƒ³ãƒ—ãƒ«ãªæœ¨ã®ãƒªãƒ³ã‚°ã€‚ãƒ“ãƒ¼ãƒˆã®åˆ¤å®šçª“ãŒã‚ãšã‹ã«åºƒãŒã‚‹ã€‚',
        baseStats: [{ stat: 'beatWindow', value: 3 }],
        enchantmentSlots: 0,
    },
    {
        id: 'silver_band',
        name: 'Silver Band',
        nameJa: 'ã‚·ãƒ«ãƒãƒ¼ãƒãƒ³ãƒ‰',
        slot: 'accessory',
        rarity: 'uncommon',
        icon: 'ğŸª™',
        color: '#C0C0C0',
        glowColor: '#E0E0E0',
        description: 'A polished silver band that attunes to fortune\'s flow.',
        descriptionJa: 'ç£¨ãä¸Šã’ãŸéŠ€ã®è…•è¼ªã€‚å¹¸é‹ã®æµã‚Œã«èª¿å¾‹ã•ã‚Œã‚‹ã€‚',
        baseStats: [
            { stat: 'beatWindow', value: 5 },
            { stat: 'dropRate', value: 5 },
        ],
        enchantmentSlots: 0,
    },
    {
        id: 'gold_monocle',
        name: 'Gold Monocle',
        nameJa: 'ã‚´ãƒ¼ãƒ«ãƒ‰ãƒ¢ãƒã‚¯ãƒ«',
        slot: 'accessory',
        rarity: 'rare',
        icon: 'ğŸ§',
        color: '#FFD700',
        glowColor: '#FFECB3',
        description: 'A golden monocle that reveals hidden treasures and sharpens timing.',
        descriptionJa: 'éš ã•ã‚ŒãŸå®ã‚’è¦‹æŠœãã€ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’ç ”ãæ¾„ã¾ã™é‡‘ã®ãƒ¢ãƒã‚¯ãƒ«ã€‚',
        baseStats: [
            { stat: 'beatWindow', value: 8 },
            { stat: 'dropRate', value: 10 },
        ],
        enchantmentSlots: 0,
    },
    {
        id: 'prismatic_lens',
        name: 'Prismatic Lens',
        nameJa: 'ãƒ—ãƒªã‚ºãƒãƒ†ã‚£ãƒƒã‚¯ãƒ¬ãƒ³ã‚º',
        slot: 'accessory',
        rarity: 'epic',
        icon: 'ğŸ”¬',
        color: '#9C27B0',
        glowColor: '#CE93D8',
        description: 'A lens that splits light into seven colors, each attuned to a different frequency.',
        descriptionJa: 'å…‰ã‚’ä¸ƒè‰²ã«åˆ†è§£ã™ã‚‹ãƒ¬ãƒ³ã‚ºã€‚ãã‚Œãã‚ŒãŒç•°ãªã‚‹å‘¨æ³¢æ•°ã«èª¿å¾‹ã•ã‚Œã¦ã„ã‚‹ã€‚',
        baseStats: [
            { stat: 'beatWindow', value: 12 },
            { stat: 'dropRate', value: 15 },
        ],
        enchantmentSlots: 1,
    },
    {
        id: 'celestial_crown',
        name: 'Celestial Crown',
        nameJa: 'å¤©çƒã®å† ',
        slot: 'accessory',
        rarity: 'legendary',
        icon: 'ğŸ‘‘',
        color: '#FFFFFF',
        glowColor: '#F0F0FF',
        description: 'A crown woven from starlight threads. The universe bends to its wearer\'s will.',
        descriptionJa: 'æ˜Ÿå…‰ã®ç³¸ã§ç·¨ã¾ã‚ŒãŸå† ã€‚å®‡å®™ãŒè£…ç€è€…ã®æ„å¿—ã«å¾“ã†ã€‚',
        baseStats: [
            { stat: 'beatWindow', value: 18 },
            { stat: 'dropRate', value: 25 },
        ],
        enchantmentSlots: 2,
    },
    {
        id: 'combo_bracelet',
        name: 'Combo Bracelet',
        nameJa: 'ã‚³ãƒ³ãƒœãƒ–ãƒ¬ã‚¹ãƒ¬ãƒƒãƒˆ',
        slot: 'accessory',
        rarity: 'rare',
        icon: 'ğŸ“¿',
        color: '#FF7043',
        glowColor: '#FFAB91',
        description: 'A bracelet with chained links that resonate with each successive hit.',
        descriptionJa: 'é€£ç¶šã™ã‚‹æ‰“æ’ƒã«å…±é³´ã™ã‚‹é–ã®ãƒ–ãƒ¬ã‚¹ãƒ¬ãƒƒãƒˆã€‚',
        baseStats: [
            { stat: 'beatWindow', value: 5 },
            { stat: 'comboAmplify', value: 12 },
        ],
        enchantmentSlots: 0,
    },

    // â”€â”€ Charms (elemental) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    {
        id: 'charm_fire',
        name: 'Ember Charm',
        nameJa: 'æ®‹ã‚Šç«ã®ãŠå®ˆã‚Š',
        slot: 'charm',
        rarity: 'rare',
        icon: 'ğŸ”¥',
        color: '#FF4444',
        glowColor: '#FF8866',
        description: 'A warm charm that pulses with inner flame. Fire orbs appear more often.',
        descriptionJa: 'å†…ãªã‚‹ç‚ã§è„ˆå‹•ã™ã‚‹æ¸©ã‹ã„ãŠå®ˆã‚Šã€‚ç‚ã‚ªãƒ¼ãƒ–ã®å‡ºç¾ç‡ãŒä¸Šæ˜‡ã€‚',
        baseStats: [
            { stat: 'elementalAffinity', value: 15, element: 'fire' },
            { stat: 'reactionPower', value: 10 },
        ],
        enchantmentSlots: 0,
    },
    {
        id: 'charm_water',
        name: 'Tide Charm',
        nameJa: 'æ½®ã®ãŠå®ˆã‚Š',
        slot: 'charm',
        rarity: 'rare',
        icon: 'ğŸ’§',
        color: '#4488FF',
        glowColor: '#66AAFF',
        description: 'A cool charm that ebbs and flows like the ocean. Water orbs appear more often.',
        descriptionJa: 'æµ·ã®ã‚ˆã†ã«æº€ã¡å¼•ãã™ã‚‹å†·ãŸã„ãŠå®ˆã‚Šã€‚æ°´ã‚ªãƒ¼ãƒ–ã®å‡ºç¾ç‡ãŒä¸Šæ˜‡ã€‚',
        baseStats: [
            { stat: 'elementalAffinity', value: 15, element: 'water' },
            { stat: 'reactionPower', value: 10 },
        ],
        enchantmentSlots: 0,
    },
    {
        id: 'charm_ice',
        name: 'Frost Charm',
        nameJa: 'éœœã®ãŠå®ˆã‚Š',
        slot: 'charm',
        rarity: 'rare',
        icon: 'â„ï¸',
        color: '#88DDFF',
        glowColor: '#BBEEFF',
        description: 'A frigid charm coated in eternal frost. Ice orbs appear more often.',
        descriptionJa: 'æ°¸é ã®éœœã«è¦†ã‚ã‚ŒãŸæ¥µå¯’ã®ãŠå®ˆã‚Šã€‚æ°·ã‚ªãƒ¼ãƒ–ã®å‡ºç¾ç‡ãŒä¸Šæ˜‡ã€‚',
        baseStats: [
            { stat: 'elementalAffinity', value: 15, element: 'ice' },
            { stat: 'reactionPower', value: 10 },
        ],
        enchantmentSlots: 0,
    },
    {
        id: 'charm_lightning',
        name: 'Spark Charm',
        nameJa: 'é–ƒå…‰ã®ãŠå®ˆã‚Š',
        slot: 'charm',
        rarity: 'rare',
        icon: 'âš¡',
        color: '#FFDD44',
        glowColor: '#FFEE88',
        description: 'A crackling charm that arcs with static. Lightning orbs appear more often.',
        descriptionJa: 'é™é›»æ°—ãŒèµ°ã‚‹å¼¾ã‘ã‚‹ãŠå®ˆã‚Šã€‚é›·ã‚ªãƒ¼ãƒ–ã®å‡ºç¾ç‡ãŒä¸Šæ˜‡ã€‚',
        baseStats: [
            { stat: 'elementalAffinity', value: 15, element: 'lightning' },
            { stat: 'reactionPower', value: 10 },
        ],
        enchantmentSlots: 0,
    },
    {
        id: 'charm_nature',
        name: 'Bloom Charm',
        nameJa: 'èŠ±å’²ã®ãŠå®ˆã‚Š',
        slot: 'charm',
        rarity: 'rare',
        icon: 'ğŸŒ¿',
        color: '#44CC44',
        glowColor: '#66EE66',
        description: 'A living charm that sprouts tiny flowers. Nature orbs appear more often.',
        descriptionJa: 'å°ã•ãªèŠ±ãŒå’²ãç”ŸããŸãŠå®ˆã‚Šã€‚è‡ªç„¶ã‚ªãƒ¼ãƒ–ã®å‡ºç¾ç‡ãŒä¸Šæ˜‡ã€‚',
        baseStats: [
            { stat: 'elementalAffinity', value: 15, element: 'nature' },
            { stat: 'reactionPower', value: 10 },
        ],
        enchantmentSlots: 0,
    },
    {
        id: 'charm_dark',
        name: 'Void Charm',
        nameJa: 'è™šç„¡ã®ãŠå®ˆã‚Š',
        slot: 'charm',
        rarity: 'rare',
        icon: 'ğŸŒ‘',
        color: '#9944CC',
        glowColor: '#BB66EE',
        description: 'A charm that absorbs light around it. Dark orbs appear more often.',
        descriptionJa: 'å‘¨å›²ã®å…‰ã‚’å¸åã™ã‚‹ãŠå®ˆã‚Šã€‚é—‡ã‚ªãƒ¼ãƒ–ã®å‡ºç¾ç‡ãŒä¸Šæ˜‡ã€‚',
        baseStats: [
            { stat: 'elementalAffinity', value: 15, element: 'dark' },
            { stat: 'reactionPower', value: 10 },
        ],
        enchantmentSlots: 0,
    },
    {
        id: 'charm_vaporize',
        name: 'Steam Core Charm',
        nameJa: 'è’¸æ°—æ ¸ã®ãŠå®ˆã‚Š',
        slot: 'charm',
        rarity: 'epic',
        icon: 'ğŸ’¨',
        color: '#FF8844',
        glowColor: '#FFAA66',
        description: 'A charm forged where fire meets water. Amplifies Vaporize reactions.',
        descriptionJa: 'ç‚ã¨æ°´ãŒå‡ºä¼šã†å ´æ‰€ã§é›ãˆã‚‰ã‚ŒãŸãŠå®ˆã‚Šã€‚è’¸ç™ºåå¿œã‚’å¼·åŒ–ã€‚',
        baseStats: [
            { stat: 'elementalAffinity', value: 12, element: 'fire' },
            { stat: 'elementalAffinity', value: 12, element: 'water' },
            { stat: 'reactionPower', value: 18 },
        ],
        enchantmentSlots: 1,
    },
    {
        id: 'charm_superconduct',
        name: 'Tempest Core Charm',
        nameJa: 'åµæ ¸ã®ãŠå®ˆã‚Š',
        slot: 'charm',
        rarity: 'epic',
        icon: 'ğŸŒ©ï¸',
        color: '#88BBFF',
        glowColor: '#AADDFF',
        description: 'A charm vibrating at the frequency of ice and lightning. Amplifies Superconduct reactions.',
        descriptionJa: 'æ°·ã¨é›·ã®å‘¨æ³¢æ•°ã§æŒ¯å‹•ã™ã‚‹ãŠå®ˆã‚Šã€‚è¶…é›»å°åå¿œã‚’å¼·åŒ–ã€‚',
        baseStats: [
            { stat: 'elementalAffinity', value: 12, element: 'ice' },
            { stat: 'elementalAffinity', value: 12, element: 'lightning' },
            { stat: 'reactionPower', value: 18 },
        ],
        enchantmentSlots: 1,
    },
    {
        id: 'charm_bloom_nature',
        name: 'Genesis Bloom Charm',
        nameJa: 'å‰µç”ŸèŠ±ã®ãŠå®ˆã‚Š',
        slot: 'charm',
        rarity: 'epic',
        icon: 'ğŸŒ¸',
        color: '#44CC88',
        glowColor: '#66EEAA',
        description: 'A charm woven from primal vines and dewdrops. Amplifies Bloom reactions.',
        descriptionJa: 'åŸå§‹ã®è”“ã¨æœéœ²ã§ç·¨ã¾ã‚ŒãŸãŠå®ˆã‚Šã€‚é–‹èŠ±åå¿œã‚’å¼·åŒ–ã€‚',
        baseStats: [
            { stat: 'elementalAffinity', value: 12, element: 'nature' },
            { stat: 'elementalAffinity', value: 12, element: 'water' },
            { stat: 'reactionPower', value: 18 },
        ],
        enchantmentSlots: 1,
    },
    {
        id: 'charm_omniscient',
        name: 'Omniscient Talisman',
        nameJa: 'å…¨çŸ¥ã®è­·ç¬¦',
        slot: 'charm',
        rarity: 'legendary',
        icon: 'ğŸŒ€',
        color: '#FFFFFF',
        glowColor: '#F0F0FF',
        description: 'A talisman that resonates with every element. The pinnacle of elemental mastery.',
        descriptionJa: 'å…¨å±æ€§ã«å…±é³´ã™ã‚‹è­·ç¬¦ã€‚å±æ€§æ”¯é…ã®é ‚ç‚¹ã€‚',
        baseStats: [
            { stat: 'elementalAffinity', value: 10, element: 'fire' },
            { stat: 'elementalAffinity', value: 10, element: 'water' },
            { stat: 'elementalAffinity', value: 10, element: 'ice' },
            { stat: 'elementalAffinity', value: 10, element: 'lightning' },
            { stat: 'elementalAffinity', value: 10, element: 'nature' },
            { stat: 'elementalAffinity', value: 10, element: 'dark' },
            { stat: 'reactionPower', value: 25 },
        ],
        enchantmentSlots: 2,
    },
    {
        id: 'charm_terrain',
        name: 'Earthshaker Pendant',
        nameJa: 'åœ°éœ‡ã®ãƒšãƒ³ãƒ€ãƒ³ãƒˆ',
        slot: 'charm',
        rarity: 'epic',
        icon: 'â›°ï¸',
        color: '#8D6E63',
        glowColor: '#BCAAA4',
        description: 'A heavy pendant that channels seismic energy into devastating terrain strikes.',
        descriptionJa: 'åœ°éœ‡ã®ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’åœ°å½¢ã¸ã®ç ´å£Šçš„ä¸€æ’ƒã«å¤‰æ›ã™ã‚‹é‡ã„ãƒšãƒ³ãƒ€ãƒ³ãƒˆã€‚',
        baseStats: [
            { stat: 'terrainDamage', value: 20 },
            { stat: 'reactionPower', value: 12 },
        ],
        enchantmentSlots: 1,
    },
    {
        id: 'charm_combo',
        name: 'Rhythm Heart Charm',
        nameJa: 'ãƒªã‚ºãƒ ãƒãƒ¼ãƒˆã®ãŠå®ˆã‚Š',
        slot: 'charm',
        rarity: 'rare',
        icon: 'ğŸ’—',
        color: '#EF5350',
        glowColor: '#EF9A9A',
        description: 'A charm that beats in time with the music. Combos grow stronger.',
        descriptionJa: 'éŸ³æ¥½ã¨åŒã˜ãƒªã‚ºãƒ ã§é¼“å‹•ã™ã‚‹ãŠå®ˆã‚Šã€‚ã‚³ãƒ³ãƒœãŒã‚ˆã‚Šå¼·åŠ›ã«æˆé•·ã€‚',
        baseStats: [
            { stat: 'comboAmplify', value: 15 },
            { stat: 'comboDuration', value: 80 },
        ],
        enchantmentSlots: 0,
    },
];

// ===== Registry Lookups =====

/** All equipment definitions indexed by ID. */
export const EQUIPMENT_REGISTRY: Record<string, EquipmentDefinition> = Object.fromEntries(
    EQUIPMENT.map(eq => [eq.id, eq])
);

/** Get an equipment definition by ID, or undefined if not found. */
export function getEquipment(id: string): EquipmentDefinition | undefined {
    return EQUIPMENT_REGISTRY[id];
}

/** All equipment as a flat array. */
export const ALL_EQUIPMENT = EQUIPMENT;

/** Equipment grouped by slot. */
export const EQUIPMENT_BY_SLOT: Record<string, EquipmentDefinition[]> = {
    weapon: EQUIPMENT.filter(e => e.slot === 'weapon'),
    armor: EQUIPMENT.filter(e => e.slot === 'armor'),
    accessory: EQUIPMENT.filter(e => e.slot === 'accessory'),
    charm: EQUIPMENT.filter(e => e.slot === 'charm'),
};

// ===== Loot Tables (one per world) =====

export const LOOT_TABLES: LootTable[] = [
    // World 1: Heavily weighted toward common/uncommon
    {
        worldIdx: 0,
        lineCountBonus: 0.01,
        comboBonus: 0.005,
        entries: [
            // Common (50%)
            { equipmentId: 'wooden_baton', weight: 12 },
            { equipmentId: 'cloth_robe', weight: 13 },
            { equipmentId: 'wooden_ring', weight: 13 },
            { equipmentId: 'charm_combo', weight: 12 },
            // Uncommon (35%)
            { equipmentId: 'crystal_wand', weight: 12 },
            { equipmentId: 'iron_vest', weight: 12 },
            { equipmentId: 'silver_band', weight: 11 },
            // Rare (12%)
            { equipmentId: 'flame_striker', weight: 2 },
            { equipmentId: 'crystal_mail', weight: 2 },
            { equipmentId: 'gold_monocle', weight: 2 },
            { equipmentId: 'charm_fire', weight: 1.5 },
            { equipmentId: 'charm_water', weight: 1.5 },
            { equipmentId: 'charm_ice', weight: 1.5 },
            { equipmentId: 'charm_lightning', weight: 1.5 },
            // Epic (2.5%)
            { equipmentId: 'thunder_gavel', weight: 0.5 },
            { equipmentId: 'obsidian_plate', weight: 0.5 },
            { equipmentId: 'prismatic_lens', weight: 0.5 },
            { equipmentId: 'charm_vaporize', weight: 0.5 },
            { equipmentId: 'charm_terrain', weight: 0.5 },
            // Legendary (0.5%)
            { equipmentId: 'star_conductor_baton', weight: 0.1 },
            { equipmentId: 'star_aegis', weight: 0.1 },
            { equipmentId: 'celestial_crown', weight: 0.1 },
            { equipmentId: 'charm_omniscient', weight: 0.2 },
        ],
    },
    // World 2: Slightly better odds
    {
        worldIdx: 1,
        lineCountBonus: 0.012,
        comboBonus: 0.006,
        entries: [
            // Common (40%)
            { equipmentId: 'wooden_baton', weight: 10 },
            { equipmentId: 'cloth_robe', weight: 10 },
            { equipmentId: 'wooden_ring', weight: 10 },
            { equipmentId: 'charm_combo', weight: 10 },
            // Uncommon (35%)
            { equipmentId: 'crystal_wand', weight: 12 },
            { equipmentId: 'iron_vest', weight: 12 },
            { equipmentId: 'silver_band', weight: 11 },
            // Rare (18%)
            { equipmentId: 'flame_striker', weight: 3 },
            { equipmentId: 'crystal_mail', weight: 3 },
            { equipmentId: 'gold_monocle', weight: 3 },
            { equipmentId: 'dark_requiem', weight: 2 },
            { equipmentId: 'nature_weave', weight: 2 },
            { equipmentId: 'combo_bracelet', weight: 2 },
            { equipmentId: 'charm_fire', weight: 0.5 },
            { equipmentId: 'charm_water', weight: 0.5 },
            { equipmentId: 'charm_nature', weight: 0.5 },
            { equipmentId: 'charm_dark', weight: 0.5 },
            // Epic (5%)
            { equipmentId: 'thunder_gavel', weight: 1 },
            { equipmentId: 'obsidian_plate', weight: 1 },
            { equipmentId: 'prismatic_lens', weight: 1 },
            { equipmentId: 'charm_vaporize', weight: 1 },
            { equipmentId: 'charm_terrain', weight: 1 },
            // Legendary (2%)
            { equipmentId: 'star_conductor_baton', weight: 0.5 },
            { equipmentId: 'star_aegis', weight: 0.5 },
            { equipmentId: 'celestial_crown', weight: 0.5 },
            { equipmentId: 'charm_omniscient', weight: 0.5 },
        ],
    },
    // World 3: Balanced mid-game
    {
        worldIdx: 2,
        lineCountBonus: 0.015,
        comboBonus: 0.007,
        entries: [
            // Common (30%)
            { equipmentId: 'wooden_baton', weight: 7 },
            { equipmentId: 'cloth_robe', weight: 8 },
            { equipmentId: 'wooden_ring', weight: 8 },
            { equipmentId: 'charm_combo', weight: 7 },
            // Uncommon (30%)
            { equipmentId: 'crystal_wand', weight: 10 },
            { equipmentId: 'iron_vest', weight: 10 },
            { equipmentId: 'silver_band', weight: 10 },
            // Rare (25%)
            { equipmentId: 'flame_striker', weight: 3 },
            { equipmentId: 'crystal_mail', weight: 3 },
            { equipmentId: 'gold_monocle', weight: 3 },
            { equipmentId: 'dark_requiem', weight: 2 },
            { equipmentId: 'nature_weave', weight: 2 },
            { equipmentId: 'combo_bracelet', weight: 2 },
            { equipmentId: 'charm_fire', weight: 1.5 },
            { equipmentId: 'charm_water', weight: 1.5 },
            { equipmentId: 'charm_ice', weight: 1.5 },
            { equipmentId: 'charm_lightning', weight: 1.5 },
            { equipmentId: 'charm_nature', weight: 1.5 },
            { equipmentId: 'charm_dark', weight: 1.5 },
            // Epic (10%)
            { equipmentId: 'thunder_gavel', weight: 1.5 },
            { equipmentId: 'obsidian_plate', weight: 1.5 },
            { equipmentId: 'prismatic_lens', weight: 1.5 },
            { equipmentId: 'charm_vaporize', weight: 1.5 },
            { equipmentId: 'charm_superconduct', weight: 1.5 },
            { equipmentId: 'charm_bloom_nature', weight: 1.5 },
            { equipmentId: 'charm_terrain', weight: 1 },
            // Legendary (5%)
            { equipmentId: 'star_conductor_baton', weight: 1.25 },
            { equipmentId: 'star_aegis', weight: 1.25 },
            { equipmentId: 'celestial_crown', weight: 1.25 },
            { equipmentId: 'charm_omniscient', weight: 1.25 },
        ],
    },
    // World 4: Skewed toward higher rarity
    {
        worldIdx: 3,
        lineCountBonus: 0.018,
        comboBonus: 0.008,
        entries: [
            // Common (25%)
            { equipmentId: 'wooden_baton', weight: 6 },
            { equipmentId: 'cloth_robe', weight: 6 },
            { equipmentId: 'wooden_ring', weight: 7 },
            { equipmentId: 'charm_combo', weight: 6 },
            // Uncommon (28%)
            { equipmentId: 'crystal_wand', weight: 9 },
            { equipmentId: 'iron_vest', weight: 9 },
            { equipmentId: 'silver_band', weight: 10 },
            // Rare (27%)
            { equipmentId: 'flame_striker', weight: 3 },
            { equipmentId: 'crystal_mail', weight: 3 },
            { equipmentId: 'gold_monocle', weight: 3 },
            { equipmentId: 'dark_requiem', weight: 3 },
            { equipmentId: 'nature_weave', weight: 3 },
            { equipmentId: 'combo_bracelet', weight: 3 },
            { equipmentId: 'charm_fire', weight: 1.5 },
            { equipmentId: 'charm_water', weight: 1.5 },
            { equipmentId: 'charm_ice', weight: 1.5 },
            { equipmentId: 'charm_lightning', weight: 1.5 },
            { equipmentId: 'charm_nature', weight: 1.5 },
            { equipmentId: 'charm_dark', weight: 1.5 },
            // Epic (13%)
            { equipmentId: 'thunder_gavel', weight: 2 },
            { equipmentId: 'obsidian_plate', weight: 2 },
            { equipmentId: 'prismatic_lens', weight: 2 },
            { equipmentId: 'charm_vaporize', weight: 1.5 },
            { equipmentId: 'charm_superconduct', weight: 1.5 },
            { equipmentId: 'charm_bloom_nature', weight: 1.5 },
            { equipmentId: 'charm_terrain', weight: 2.5 },
            // Legendary (7%)
            { equipmentId: 'star_conductor_baton', weight: 1.75 },
            { equipmentId: 'star_aegis', weight: 1.75 },
            { equipmentId: 'celestial_crown', weight: 1.75 },
            { equipmentId: 'charm_omniscient', weight: 1.75 },
        ],
    },
    // World 5: Best drops â€” fewer commons, many rares and epics
    {
        worldIdx: 4,
        lineCountBonus: 0.02,
        comboBonus: 0.01,
        entries: [
            // Common (20%)
            { equipmentId: 'wooden_baton', weight: 5 },
            { equipmentId: 'cloth_robe', weight: 5 },
            { equipmentId: 'wooden_ring', weight: 5 },
            { equipmentId: 'charm_combo', weight: 5 },
            // Uncommon (20%)
            { equipmentId: 'crystal_wand', weight: 7 },
            { equipmentId: 'iron_vest', weight: 7 },
            { equipmentId: 'silver_band', weight: 6 },
            // Rare (30%)
            { equipmentId: 'flame_striker', weight: 3.5 },
            { equipmentId: 'crystal_mail', weight: 3.5 },
            { equipmentId: 'gold_monocle', weight: 3.5 },
            { equipmentId: 'dark_requiem', weight: 3 },
            { equipmentId: 'nature_weave', weight: 3 },
            { equipmentId: 'combo_bracelet', weight: 3 },
            { equipmentId: 'charm_fire', weight: 1.75 },
            { equipmentId: 'charm_water', weight: 1.75 },
            { equipmentId: 'charm_ice', weight: 1.75 },
            { equipmentId: 'charm_lightning', weight: 1.75 },
            { equipmentId: 'charm_nature', weight: 1.75 },
            { equipmentId: 'charm_dark', weight: 1.75 },
            // Epic (15%)
            { equipmentId: 'thunder_gavel', weight: 2.5 },
            { equipmentId: 'obsidian_plate', weight: 2.5 },
            { equipmentId: 'prismatic_lens', weight: 2.5 },
            { equipmentId: 'charm_vaporize', weight: 2 },
            { equipmentId: 'charm_superconduct', weight: 2 },
            { equipmentId: 'charm_bloom_nature', weight: 2 },
            { equipmentId: 'charm_terrain', weight: 1.5 },
            // Legendary (5%)  (relative to total â€” higher absolute)
            { equipmentId: 'star_conductor_baton', weight: 1.25 },
            { equipmentId: 'star_aegis', weight: 1.25 },
            { equipmentId: 'celestial_crown', weight: 1.25 },
            { equipmentId: 'charm_omniscient', weight: 1.25 },
        ],
    },
];

/** Get loot table for a world, falling back to last table for higher worlds. */
export function getLootTable(worldIdx: number): LootTable {
    if (worldIdx < 0) return LOOT_TABLES[0];
    if (worldIdx >= LOOT_TABLES.length) return LOOT_TABLES[LOOT_TABLES.length - 1];
    return LOOT_TABLES[worldIdx];
}
